<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://kit.fontawesome.com/64d58efce2.js"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="Mstyle.css" />
    <title>Sanjeevni-Pehchan Jeevan Ki</title>
  </head>
  <body>
    <div class="container">
      <div class="forms-container">
        <div class="signin-signup">
          <form action="#" class="sign-in-form">
            <h2 class="title">Register Medicine</h2>
                    <div class="input-field">
                        <i class="fas fa-barcode"></i>
                        <input type="text" placeholder="Barcode" id=Mid>
                    </div>
                    <div class="input-field">
                        <i class="fas fa-pills"></i>
                        <input type="text" placeholder="Medicine Name" id=Mname>
                    </div>
                    <div class="input-field">
                        <i class="fas fa-signature"></i>
                        <input type="text" placeholder="Description" id=Mdesc>
                    </div>
                    <div class="input-field">
                        <i class="fas fa-weight"></i>
                        <input type="text" placeholder="Weight" id=Mwt>
                    </div>
                    <div class="input-field">
                        <i class="fas fa-archway"></i>
                        <input type="text" placeholder="Manufactured by" id="Mfd_by">
                    </div>
                    <div class="input-field">
                        <i class="fas fa-search-location"></i>
                        <input type="text" placeholder="Manufactured in" id=Mfd_in>
                    </div>
                    <div class="input-field">
                        <i class="fas fa-dollar-sign"></i>
                        <input type="text" placeholder="Price" id="Mrate">
                    </div>
                    <div class="input-field">
                        <i class="fas fa-tag"></i>
                        <input type="text" placeholder="Batch No." id="batch">
                    </div>
                    <div class="input-field">
                        <i class="fas fa-calendar-plus"></i>
                        <input type="text" placeholder="Date of Mfg.(mm-yyyy)" id=mfg>
                    </div>
                    <div class="input-field">
                        <i class="fas fa-calendar-times"></i>
                        <input type="text" placeholder="Date of Exp.(mm-yyyy)" id="exp">
                    </div>
            <input type="submit" value="Register" id="AddMed" class="btn solid">
          </form>
          <form action="#" class="sign-up-form">
            <h2 class="title">Batch Update</h2>
              <div class="input-field">
                  <i class="fas fa-barcode"></i>
                  <input type="text" placeholder="Barcode" id="B_Mid">
              </div>
              <div class="input-field">
                  <i class="fas fa-tag"></i>
                  <input type="text" placeholder="Batch No." id="B_batch">
              </div>
              <div class="input-field">
                  <i class="fas fa-calendar-plus"></i>
                  <input type="text" placeholder="Date of Mfg.(mm-yyyy)" id="B_mfg">
              </div>
              <div class="input-field">
                  <i class="fas fa-calendar-times"></i>
                  <input type="text" placeholder="Date of Exp.(mm-yyyy)" id="B_exp">
              </div>
            <input type="submit" class="btn" value="Update"  id="U_batch">
            
          </form>
        </div>
      </div>

      <div class="panels-container">
        <div class="panel left-panel">
          <div class="content">
            <h3>Batch Update ?</h3>
            <p>
              Update the Batch details of registered Medicine
            </p>
            <button class="btn transparent" id="sign-up-btn">
              Update
            </button>
          </div>
          <img src="img/medicine.svg" class="image" alt="" />
        </div>
        <div class="panel right-panel">
          <div class="content">
            <h3>New Medicine ?</h3>
            <p>
              Register New Medicines inside Blockchain
            </p>
            <button class="btn transparent" id="sign-in-btn">
              Register
            </button>
          </div>
          <img src="img/medicine.svg" class="image" alt="" />
        </div>
      </div>
    </div>

    <script src="Mapp.js"></script>

    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
      <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.34/dist/web3.min.js"></script>

	  <script>
        var contract;
		$(document).ready(function(){
		web3 = new Web3(web3.currentProvider);
		var address = "0xC0577ab9b2b984a74DE5d831AA1C585f3732A28D";
		var abi =[
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "dob",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "pwd",
				"type": "string"
			}
		],
		"name": "add_dev",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "BID",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "wt",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "mfg_by",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "mfg_in",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "desc",
				"type": "string"
			},
			{
				"internalType": "int256",
				"name": "rate",
				"type": "int256"
			},
			{
				"internalType": "string",
				"name": "batch",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "mfd_date",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "expire",
				"type": "string"
			}
		],
		"name": "add_new_medi",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "dev_acc",
				"type": "address"
			}
		],
		"name": "approve_dev",
		"outputs": [
			{
				"internalType": "bool",
				"name": "success",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "BID",
				"type": "uint256"
			}
		],
		"name": "approve_medi",
		"outputs": [
			{
				"internalType": "bool",
				"name": "success",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "BID",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "batch",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "mfd_date",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "expire",
				"type": "string"
			}
		],
		"name": "modify_medi_batch",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "creatorAdmin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "acc",
				"type": "address"
			}
		],
		"name": "get_dev",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "enum Medicine.State",
				"name": "",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "bcd",
				"type": "uint256"
			}
		],
		"name": "get_info",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "int256",
				"name": "",
				"type": "int256"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "bcd",
				"type": "uint256"
			}
		],
		"name": "medi_status",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "enum Medicine.State",
				"name": "",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "x",
				"type": "string"
			}
		],
		"name": "test",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	}
];
		contract = new web3.eth.Contract(abi,address);
		})

		$('#AddMed').click(function(){
			var Medicine_id = "";
			var Medicine_name = "";
			var Medicine_desc = "";
			var Medicine_weight = "";
			var made_by = "";
			var made_in = "";
			var Medicine_price = "";
			var Batch_no = "";
			var mfg_on = "";
			var expire_on = "";

			Medicine_id =parseInt($("#Mid").val());
			Medicine_name =$("#Mname").val();
			Medicine_desc =$("#Mdesc").val();
			Medicine_weight =$("#Mwt").val();
			made_by =$("#Mfd_by").val();
			made_in =$("#Mfd_in").val();
			Medicine_price =parseInt($("#Mrate").val());
			Batch_no =$("#batch").val();
			mfg_on =$("#mfg").val();
			expire_on =$("#exp").val();

			web3.eth.getAccounts().then(function(accounts){
				var acc = accounts[0];
				contract.methods.add_new_medi(Medicine_id,Medicine_name,Medicine_weight,made_by,made_in,Medicine_desc,Medicine_price,Batch_no,mfg_on,expire_on).send({from: acc});
			}).then(function(tx){
				console.log(tx);
			}).catch(function(tx){
				console.log(tx);
			})  
		})

		$('#U_batch').click(function(){
			var Medicine_id = "";
			var Batch_no = "";
			var mfg_on = "";
			var expire_on = "";

			Medicine_id =parseInt($("#B_Mid").val());
			Batch_no =$("#B_batch").val();
			mfg_on =$("#B_mfg").val();
			expire_on =$("#B_exp").val();

			web3.eth.getAccounts().then(function(accounts){
				var acc = accounts[0];
				contract.methods.modify_medi_batch(Medicine_id,Batch_no,mfg_on,expire_on).send({from: acc});
				
			}).then(function(tx){
				console.log(tx);
			}).catch(function(tx){
				console.log(tx);
			})  
		})
    </script>
  </body>
</html>
